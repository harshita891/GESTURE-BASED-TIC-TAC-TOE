<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe with Hand Gesture Recognition</title>
</head>
<body>
    <!-- Display the Tic Tac Toe board -->
    <canvas id="ticTacToeBoard" width="300" height="300"></canvas>

    <!-- Import Mediapipe library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mediapipe/0.8.4/mediapipe.js"></script>
    <script>
        const canvas = document.getElementById('ticTacToeBoard');
        const ctx = canvas.getContext('2d');
        const cellSize = 100; // Size of each cell in pixels
        let board = [[0, 0, 0], [0, 0, 0], [0, 0, 0]]; // Tic Tac Toe board
        let currentPlayer = 1; // Player 1 starts the game
        let winner = 0; // No winner initially

        // Function to draw Tic Tac Toe board
        function drawBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;

            // Draw vertical lines
            for (let i = 1; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(i * cellSize, 0);
                ctx.lineTo(i * cellSize, canvas.height);
                ctx.stroke();
            }

            // Draw horizontal lines
            for (let i = 1; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * cellSize);
                ctx.lineTo(canvas.width, i * cellSize);
                ctx.stroke();
            }

            // Draw Xs and Os
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (board[i][j] === 1) {
                        drawX(j * cellSize, i * cellSize);
                    } else if (board[i][j] === 2) {
                        drawO(j * cellSize + cellSize / 2, i * cellSize + cellSize / 2);
                    }
                }
            }
        }

        // Function to draw X
        function drawX(x, y) {
            ctx.strokeStyle = '#f00';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(x + 20, y + 20);
            ctx.lineTo(x + cellSize - 20, y + cellSize - 20);
            ctx.moveTo(x + cellSize - 20, y + 20);
            ctx.lineTo(x + 20, y + cellSize - 20);
            ctx.stroke();
        }

        // Function to draw O
        function drawO(x, y) {
            ctx.strokeStyle = '#00f';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.arc(x, y, cellSize / 2 - 20, 0, 2 * Math.PI);
            ctx.stroke();
        }

        // Initialize Mediapipe hands
        const hands = new mp.Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
        hands.onResults(handleHandResults);
        hands.initialize();

        // Function to handle hand gesture results
        function handleHandResults(results) {
            const hand = results.multiHandLandmarks[0];
            if (!hand) return;

            const wrist = hand.landmarks[mp.HandLandmark.WRIST];
            const thumbTip = hand.landmarks[mp.HandLandmark.THUMB_TIP];
            const indexTip = hand.landmarks[mp.HandLandmark.INDEX_FINGER_TIP];

            // Check if the thumb tip is above the wrist and the index finger tip is below the wrist
            if (thumbTip.y < wrist.y && indexTip.y > wrist.y) {
                const cellX = Math.floor(indexTip.x * canvas.width / 3);
                const cellY = Math.floor(indexTip.y * canvas.height / 3);
                const boardX = Math.floor(cellX / cellSize);
                const boardY = Math.floor(cellY / cellSize);
                if (board[boardY][boardX] === 0 && winner === 0) {
                    board[boardY][boardX] = currentPlayer;
                    if (checkWin(currentPlayer)) {
                        winner = currentPlayer;
                    } else {
                        currentPlayer = currentPlayer === 1 ? 2 : 1;
                    }
                }
            }
        }

        // Function to check for a win
        function checkWin(player) {
            // Check rows, columns, and diagonals for winning condition
            for (let i = 0; i < 3; i++) {
                if (board[i][0] === player && board[i][1] === player && board[i][2] === player) return true; // Rows
                if (board[0][i] === player && board[1][i] === player && board[2][i] === player) return true; // Columns
            }
            if (board[0][0] === player && board[1][1] === player && board[2][2] === player) return true; // Diagonal
            if (board[0][2] === player && board[1][1] === player && board[2][0] === player) return true; // Diagonal
            return false;
        }

        // Main function to run the game
        function runGame() {
            drawBoard();
            hands.send({ image: canvas });
            if (winner !== 0) {
                alert(`Player ${winner} wins!`);
            }
            requestAnimationFrame(runGame);
        }

        // Start the game loop
        runGame();
    </script>
</body>
</html>
